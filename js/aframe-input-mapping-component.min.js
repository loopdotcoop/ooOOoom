!function(e){function n(t){if(r[t])return r[t].exports;var i=r[t]={exports:{},id:t,loaded:!1};return e[t].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};return n.m=e,n.c=r,n.p="",n(0)}([function(e,n){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.currentInputMapping="default",AFRAME.inputMappings={},AFRAME.inputActions={},AFRAME.registerSystem("input-mapping",{mappings:{},mappingsPerControllers:{},loadedControllers:[],init:function(){var e=this;this.keyboardHandler=this.keyboardHandler.bind(this),this.sceneEl.addEventListener("inputmappingregistered",function(){e.removeControllersListeners();for(var n=0;n<e.loadedControllers.length;n++){var r=e.loadedControllers[n];e.updateControllersListeners(r)}}),this.sceneEl.addEventListener("controllerconnected",function(n){var r=e.findMatchingController(n.detail.target);if(r)return void e.updateControllersListeners(r);var t={name:n.detail.name,hand:n.detail.component.data.hand,element:n.detail.target,handlers:{}};e.loadedControllers.push(t),e.updateControllersListeners(t)}),this.sceneEl.addEventListener("controllerdisconnected",function(n){var r=e.findMatchingController(n.detail.target);r&&e.removeControllerListeners(r)}),this.addKeyboardListeners()},findMatchingController:function(e){var n,r;for(r=0;r<this.loadedControllers.length;r++)if(n=this.loadedControllers[r],n.element===e)return n},addKeyboardListeners:function(){document.addEventListener("keyup",this.keyboardHandler),document.addEventListener("keydown",this.keyboardHandler),document.addEventListener("keypress",this.keyboardHandler)},removeKeyboardListeners:function(){document.removeEventListener("keyup",this.keyboardHandler),document.removeEventListener("keydown",this.keyboardHandler),document.removeEventListener("keypress",this.keyboardHandler)},removeControllerListeners:function(e){for(var n in e.handlers){var r=e.handlers[n];e.element.removeEventListener(n,r)}e.handlers={}},updateControllersListeners:function(e){if(this.removeControllerListeners(e),!AFRAME.inputMappings)return void console.warn("input-mapping: No mappings defined");var n=this.mappingsPerControllers[e.name]={};for(var r in AFRAME.inputMappings){var t=AFRAME.inputMappings[r],i=t.common;i&&this.updateMappingsPerController(i,n,r);var o=t[e.name];o?this.updateMappingsPerController(o,n,r):console.warn("input-mapping: No mappings defined for controller type: ",e.name)}var a=this;for(var s in n){var l=function(e){var r=n[e.type],t=r[AFRAME.currentInputMapping];if(t){if("object"==typeof t){var i=a.findMatchingController(e.detail.target);if(t=t[i.hand],!t)return}e.detail.target.emit(t,e.detail)}};e.element.addEventListener(s,l),e.handlers[s]=l}},keyboardHandler:function(e){var n=AFRAME.inputMappings[AFRAME.currentInputMapping];if(n&&n.keyboard){n=n.keyboard;var r=32===e.keyCode?"Space":e.key,t=(r+"_"+e.type.substr(3)).toLowerCase(),i=n[t];i&&this.sceneEl.emit(i)}},updateMappingsPerController:function(e,n,r){for(var t in e){var i=e[t];n[t]||(n[t]={}),n[t][r]=i}},removeControllersListeners:function(){for(var e=0;e<this.loadedControllers.length;e++){var n=this.loadedControllers[e];this.removeControllerListeners(n)}this.mappingsPerControllers={}}}),AFRAME.registerInputActions=function(e){AFRAME.inputActions=e},AFRAME.registerInputMappings=function(e,n){if(n||0===Object.keys(AFRAME.inputMappings).length)AFRAME.inputMappings=e;else for(var r in e){var t=e[r];if(AFRAME.inputMappings[r])for(var i in t){var o=t[i];if(AFRAME.inputMappings[r][i])for(var a in o)AFRAME.inputMappings[r][i][a]=o[a];else AFRAME.inputMappings[r][i]=o}else AFRAME.inputMappings[r]=t}if(AFRAME.scenes)for(var s=0;s<AFRAME.scenes.length;s++)AFRAME.scenes[s].emit("inputmappingregistered")}}]);